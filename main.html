<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Emotion Detection - Camera &amp; Upload with Emotion Analysis
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: "Inter", sans-serif;
    }
   #canvas, #uploadedImage {
     max-height: 320px;
     object-fit: contain;
     background: #f9fafb;
   }
  </style>
 </head>
 <body class="bg-gray-50 min-h-screen flex flex-col items-center justify-start py-8 px-4">
  <div class="max-w-5xl w-full bg-white rounded-lg shadow-lg p-8">
   <h1 class="text-3xl font-bold mb-6 text-center text-indigo-700">
    Real-time Emotion Detection
   </h1>
   <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <section>
     <h2 class="text-xl font-semibold mb-4 text-indigo-600 flex items-center space-x-2">
      <i class="fas fa-video">
      </i>
      <span>
       Camera Capture
      </span>
     </h2>
     <div class="border border-gray-300 rounded-md overflow-hidden mb-4">
      <video autoplay="" class="w-full h-64 object-cover bg-black" id="video" muted="" playsinline="">
      </video>
     </div>
     <button class="w-full bg-indigo-600 text-white font-semibold py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4" id="captureBtn" type="button">
      Capture Image
     </button>
     <div class="border border-gray-300 rounded-md overflow-hidden mb-4">
      <canvas aria-label="Captured image from camera" class="w-full" height="480" id="canvas" width="640">
      </canvas>
     </div>
     <div class="text-center text-lg font-semibold text-indigo-700 min-h-[2.5rem]" id="cameraEmotion">
     </div>
    </section>
    <section>
     <h2 class="text-xl font-semibold mb-4 text-indigo-600 flex items-center space-x-2">
      <i class="fas fa-upload">
      </i>
      <span>
       Upload Image
      </span>
     </h2>
     <input accept="image/*" class="block w-full text-gray-700 mb-4" id="uploadInput" type="file"/>
     <div class="border border-gray-300 rounded-md overflow-hidden mb-4">
      <img alt="Uploaded image preview for emotion detection" class="w-full" height="400" id="uploadedImage" src="https://storage.googleapis.com/a1aa/image/826c17dd-f549-441d-af10-b93ae74d8bc8.jpg" width="600"/>
     </div>
     <div class="text-center text-lg font-semibold text-indigo-700 min-h-[2.5rem]" id="uploadEmotion">
     </div>
    </section>
   </div>
   <section class="mt-10 max-w-xl mx-auto">
    <h2 class="text-xl font-semibold mb-4 text-indigo-600 flex items-center space-x-2 justify-center">
     <i class="fas fa-comment-dots">
     </i>
     <span>
      Feedback
     </span>
    </h2>
    <form class="space-y-4" id="feedbackForm">
     <div>
      <label class="block text-sm font-medium text-gray-700" for="feedbackEmail">
       Your Email
      </label>
      <input class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-500 focus:ring-indigo-500 focus:outline-none" id="feedbackEmail" name="feedbackEmail" placeholder="you@example.com" required="" type="email"/>
     </div>
     <div>
      <label class="block text-sm font-medium text-gray-700" for="feedbackMessage">
       Your Feedback
      </label>
      <textarea class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-500 focus:ring-indigo-500 focus:outline-none" id="feedbackMessage" name="feedbackMessage" placeholder="Write your feedback here..." required="" rows="4"></textarea>
     </div>
     <button class="w-full bg-green-600 text-white font-semibold py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500" type="submit">
      Submit Feedback
     </button>
    </form>
    <p class="mt-4 text-center text-sm text-gray-600" id="feedbackStatus">
    </p>
   </section>
  </div>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js">
  </script>
  <script>
   // Firebase configuration (replace with your own config)
    const firebaseConfig = {
      apiKey: "AIzaSyD-EXAMPLE-KEY-1234567890",
      authDomain: "your-project-id.firebaseapp.com",
      databaseURL: "https://your-project-id-default-rtdb.firebaseio.com",
      projectId: "your-project-id",
      storageBucket: "your-project-id.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abcdef123456"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Camera setup
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const captureBtn = document.getElementById("captureBtn");
    const ctx = canvas.getContext("2d");
    const cameraEmotion = document.getElementById("cameraEmotion");

    // Set canvas size to match video display size
    function setCanvasSize() {
      canvas.width = video.videoWidth || 640;
      canvas.height = video.videoHeight || 480;
    }

    // Start camera stream
    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });  
        video.srcObject = stream;
        video.onloadedmetadata = () => {
          setCanvasSize();
        };
      } catch (err) {
        alert("Could not access the camera. Please allow camera access or use image upload.");
      }
    }
    startCamera();

    // Emotion detection simulation function
    // In real app, replace this with actual ML model or API call
    function detectEmotionFromImage(imageDataURL) {
      // Simulate detection with random emotion and confidence
      const emotions = [
        "Happy",
        "Sad",
        "Angry",
        "Surprised",
        "Neutral",
        "Fearful",
        // "Disgusted",
        // "Contempt"
      ];
      const emotion = emotions[Math.floor(Math.random() * emotions.length)];
      const confidence = (Math.random() * 0.5 + 0.5).toFixed(2); // 0.5 to 1.0
      return { emotion, confidence };
    }

    // Capture image from video to canvas and detect emotion
    captureBtn.addEventListener("click", () => {
      setCanvasSize();
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const dataURL = canvas.toDataURL("image/png");
      const result = detectEmotionFromImage(dataURL);
      cameraEmotion.textContent = `Detected Emotion: ${result.emotion} (Confidence: ${(result.confidence * 100).toFixed(0)}%)`;
    });

    // Upload image preview and detect emotion
    const uploadInput = document.getElementById("uploadInput");
    const uploadedImage = document.getElementById("uploadedImage");
    const uploadEmotion = document.getElementById("uploadEmotion");

    uploadInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        uploadedImage.src = event.target.result;
        // After image loads, detect emotion
        uploadedImage.onload = () => {
          // For demo, simulate detection
          const result = detectEmotionFromImage(event.target.result);
          uploadEmotion.textContent = `Detected Emotion: ${result.emotion} (Confidence: ${(result.confidence * 100).toFixed(0)}%)`;
        };
      };
      reader.readAsDataURL(file);
    });

    // Feedback form submission to Firebase Realtime Database
    const feedbackForm = document.getElementById("feedbackForm");
    const feedbackStatus = document.getElementById("feedbackStatus");

    feedbackForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const email = feedbackForm.feedbackEmail.value.trim();
      const message = feedbackForm.feedbackMessage.value.trim();

      if (!email || !message) {
        feedbackStatus.textContent = "Please fill in all fields.";
        feedbackStatus.classList.add("text-red-600");
        feedbackStatus.classList.remove("text-green-600");
        return;
      }

      const feedbackRef = database.ref("feedbacks");
      const newFeedbackRef = feedbackRef.push();
      newFeedbackRef
        .set({
          email: email,
          message: message,
          timestamp: Date.now()
        })
        .then(() => {
          feedbackStatus.textContent = "Thank you for your feedback!";
          feedbackStatus.classList.remove("text-red-600");
          feedbackStatus.classList.add("text-green-600");
          feedbackForm.reset();
        })
        .catch((error) => {
          feedbackStatus.textContent = "Error submitting feedback. Please try again.";
          feedbackStatus.classList.add("text-red-600");
          feedbackStatus.classList.remove("text-green-600");
        });
    });
  </script>
 </body>
</html>
